<?php

namespace GL\Core\Blade;
 
use GL\Core\Helpers\Utils as Hutils;

/**
 * Load Blade utils class
 *
 */
class Utils 
{
    private static function getContainer()
    {
        return  \GL\Core\DI\ServiceProvider::GetDependencyContainer();
    }
       /**
     * Function for returning date in french format like Lundi 12 Mai 1999 23:12
     * @param \Datetime $datetime date to convert
     * @param type $lang Conversion language default french
     * @param type $pattern default pattern, french as default value
     * @return string
     */
    public static function getFrenchDate(\Datetime $datetime, $lang = 'fr_FR', $pattern = 'E dd MMM yyyy HH:mm ')
    {
            $formatter = new \IntlDateFormatter($lang, \IntlDateFormatter::LONG, \IntlDateFormatter::LONG);
            $formatter->setPattern($pattern);
            return $formatter->format($datetime);
    }

    /**
     * Get translation
     * 
     * @param string $text tag to find in local file translation
     * @param string $locale locale provided by config.yml
     * @return string string found in lang/{locale}.yml
     */
    public static function trans($text,$locale = LOCALE)
    {
        $container = self::getContainer();
        $trans = $container->get('translator');
        if($locale!=LOCALE){$trans->setLocale($locale);}
        $session = $container->get('session');
        if($session->get('twig.locale')!="")
        {
            if($trans->getLocale()!=$session->get('twig.locale')){$trans->setLocale($session->get('twig.locale'));}
        }        
        return $trans->translate($text);
    }
        
    /**
     * Convert relative url to absolute url
     * 
     * @param string $partialurl relative url
     * @return string absolute url (use BASE_PATH define in config.php)
     */
    public static function url($partialurl)
    {
        return Hutils::url($partialurl);        
    }
    
    /**
     * Get Actual Token
     * 
     * @return string Actual Crsf Token
     */
    public static function crsf()
    {
        $container = self::getContainer();
        $token = "";
        if($container!=null)
        {
            $crsf = $container->get('crsf');
            if($crsf!=null)
            {
                $token = $crsf->GetToken();
                if($token==null || $token=="")
                {
                    $token = $crsf->InitCrsf();
                }                 
            }
        }
        return $token;
    }
    
    /**
     * Return Html Input with Crsf token
     * 
     * @param string $inputname form input name
     * @return string Html Input Hidden type
     */
    public static function getcrsfinput($inputname='crsftoken')
    {
        $container = self::getContainer();
        
        $token = "";
        if($container!=null)
        {
            $crsf = $container->get('crsf');
            if($crsf!=null)
            {
                $token = $crsf->GetToken();
                if($token==null || $token=="")
                {
                    $token = $crsf->InitCrsf();
                }                 
            }
        }
        $html = "<!-- autogenerated element --><input type='hidden' value='".$token."' name='".$inputname."' id='".$inputname."'>";
        return $html;
    }
}
